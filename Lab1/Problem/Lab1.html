<!DOCTYPE html>
<html><head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Concurrent Programming Lectures (TDA382/DIT390)">
    <meta name="author" content="Alejandro Russo">

    <title>TDA383/DIT390</title>
    <link href="Lab1_files/bootstrap.css" rel="stylesheet">
    <link href="Lab1_files/bootstrap-theme.css" rel="stylesheet">


    <style>
      code, pre {
           white-space: pre-wrap;
           white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
           white-space: -pre-wrap;      /* Opera 4-6 */
           white-space: -o-pre-wrap;    /* Opera 7 */
           word-wrap: break-word;
      }
      body {padding-top: 60px;}
      mark {background-color:#666633;}
      li.L0, li.L1, li.L2, li.L3,
      li.L5, li.L6, li.L7, li.L8
      { list-style-type: decimal !important }

      .cremona { font-family: arial; font-size: 15; font-style: bold;
      background-color:LightGreen; }
      .state { font-family: arial; font-size: 15; font-style: bold; background-color:MediumTurquoise; }
      .navbar-inverse { -webkit-box-shadow: 0 0 10px #333; -moz-box-shadow: 0 0 10px #333; box-shadow: 0 0 10px #333; }
    </style>

    <!-- <style type="text/css"> -->
    <!-- h2   {font-size: 33px ;} -->
    <!-- h3   {font-size: 27px ;} -->
    <!-- <\!-- p    {font-size: 30px ;} -\-> -->
    <!-- p    {font-size: 20px ;} -->
    <!-- li   {font-size: 20px ;} -->
    <!-- pre  {font-size: 20px ;} -->
    <!-- prettyprint {font-size: 15px ;} -->
    <!-- th   {font-size: 20px ;} -->
    <!-- .imgright { float: right; } -->
    <!-- td   {font-size: 20px ;} -->
    <!-- </style> -->

<!-- ---------------- OLD Alejandro's original style ------------------ -->
    <!-- <style> -->
    <!--   code, pre { -->
    <!--        white-space: pre-wrap; -->
    <!--        white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */ -->
    <!--        white-space: -pre-wrap;      /* Opera 4-6 */ -->
    <!--        white-space: -o-pre-wrap;    /* Opera 7 */ -->
    <!--        word-wrap: break-word; -->
    <!--   } -->
    <!--   body {padding-top: 60px;} -->
    <!--   mark {background-color:#666633;} -->
    <!--   li.L0, li.L1, li.L2, li.L3, -->
    <!--   li.L5, li.L6, li.L7, li.L8 -->
    <!--   { list-style-type: decimal !important } -->

    <!--   .cremona { font-family: arial; font-size: 40; font-style: bold; -->
    <!--   background-color:LightGreen; }  -->
    <!--   .state { font-family: arial; font-size: 35; font-style: bold; background-color:MediumTurquoise; }  -->
    <!-- </style> -->
 
    <!-- <style type="text/css"> -->
    <!-- <\!-- h2   {font-size: 43px ;} -\-> -->
    <!-- <\!-- h3   {font-size: 37px ;} -\-> -->
    <!-- <\!-- p    {font-size: 30px ;} -\-> -->
    <!-- <\!-- li   {font-size: 25px ;} -\-> -->
    <!-- <\!-- pre  {font-size: 25px ;} -\-> -->
    <!-- <\!-- prettyprint {font-size: 25px ;} -\-> -->
    <!-- <\!-- th   {font-size: 30px ;} -\-> -->
    <!-- <\!-- .imgright { float: right; } -\-> -->
    <!-- <\!-- td   {font-size: 30px ;} -\-> -->
    <!-- </style> -->

<!-- ---------------- OLD Alejandro's original style ------------------ -->
  <link href="Lab1_files/default.html" type="text/css" rel="stylesheet"><link href="Lab1_files/prettify.css" type="text/css" rel="stylesheet"></head>
<body>


   <!-- Fixed navbar -->
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">TDA383/DIT390</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="http://www.cse.chalmers.se/edu/course/TDA383/index.html">Home/News</a></li>
            <li class="dropdown">
              <a href="http://www.cse.chalmers.se/edu/course/TDA383/" class="dropdown-toggle" data-toggle="dropdown">Information<b class="caret"></b></a>
              <ul class="dropdown-menu">
                    <li><a href="http://www.cse.chalmers.se/edu/course/TDA383/course_inf.html">About the course</a></li>
                    <li><a href="http://www.cse.chalmers.se/edu/course/TDA383/lit_inf.html">Literature</a></li>
                    <li><a href="http://www.cse.chalmers.se/edu/course/TDA383/time_inf.html">Time schedule</a></li>
                    <li><a href="http://www.cse.chalmers.se/edu/course/TDA383/comp_inf.html">Computer issues</a></li>
                    <li><a href="http://www.cse.chalmers.se/edu/course/TDA383/lang_inf.html">Resources for Java and Erlang</a></li>
              </ul>
            </li>
            <li class="active"><a href="http://www.cse.chalmers.se/edu/course/TDA383/lec.html">Lectures</a></li>
            <li class="dropdown">
              <a href="http://www.cse.chalmers.se/edu/course/TDA383/" class="dropdown-toggle" data-toggle="dropdown">Exercises<b class="caret"></b></a>
              <ul class="dropdown-menu">
                  <li><a href="http://www.cse.chalmers.se/edu/course/TDA383/exercises.html">Overview</a></li>
                  <li role="presentation" class="divider"></li>
                  <li><a href="http://www.cse.chalmers.se/edu/course/TDA383/ex1.html">Exercise 1</a></li>
                  <li><a href="http://www.cse.chalmers.se/edu/year/2013/course/TDA382_Concurrent_Programming_2013-2014_LP1/exercises/solutions/1.zip">Solution</a></li>
                  <li role="presentation" class="divider"></li>
                  <li><a href="http://www.cse.chalmers.se/edu/course/TDA383/ex2.html">Exercise 2</a></li>
                  <li><a href="http://www.cse.chalmers.se/edu/year/2013/course/TDA382_Concurrent_Programming_2013-2014_LP1/exercises/solutions/2.zip">Solution</a></li>
                  <li role="presentation" class="divider"></li>
                  <li><a href="http://www.cse.chalmers.se/edu/course/TDA383/ex3.html">Exercise 3</a></li>
                  <li><a href="http://www.cse.chalmers.se/edu/year/2013/course/TDA382_Concurrent_Programming_2013-2014_LP1/exercises/solutions/3.zip">Solution</a></li>
              </ul>
            </li> 
            <li class="dropdown">
              <a href="http://www.cse.chalmers.se/edu/course/TDA383/" class="dropdown-toggle" data-toggle="dropdown">Assignments<b class="caret"></b></a>
              <ul class="dropdown-menu">
                  <li><a href="http://www.cse.chalmers.se/edu/course/TDA383/labs.html">General information</a></li>
                  <li><a href="http://www.cse.chalmers.se/edu/course/TDA383/lab1.html">Lab 1: Trainspotting</a></li>
                  <li><a href="http://www.cse.chalmers.se/edu/course/TDA383/lab2.html">Lab 2: Trainspotting II</a></li>
                  <li><a href="http://www.cse.chalmers.se/edu/course/TDA383/cchat.html">Lab 3: CCHAT</a></li>
                  <li><a href="http://www.cse.chalmers.se/edu/course/TDA383/dchat.html">Lab 4: DCHAT</a></li>
              </ul>
            </li>
            <li class="active"><a href="http://www.cse.chalmers.se/edu/course/TDA383/exams.html">Exams</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>


  <div class="container"><h2 id="deadlines"><a class="header-link" href="#deadlines"></a>Deadlines</h2>
<div class="alert alert-info"> First submission deadline: 14th of September </div>

<div class="alert alert-danger"> Final submission deadline: 27th of September </div>

<p><a href="http://www.cse.chalmers.se/edu/course/TDA383/comp_inf.html">Information about how to run the lab remotely or in Windows can be found here.</a> </p>
<h2 id="lab-1"><a class="header-link" href="#lab-1"></a>Lab 1</h2>
<p>In this assignment you will write a program to control two trains. The purpose
is to write the program so that the trains move relatively independently of each
other, but without colliding.  Instead of a real railway, we have a simulator,
where one can control the speeds of trains and change rail switches. The
simulator gives a signal when a train passes sensors suitably placed on the
tracks. It is part of the assignment to decide where sensors should be placed to
give sufficient information for your program. The map without sensors looks as
follows.</p>
<div style="padding: 8px" align="center">
<img src="Lab1_files/map.gif" class="img-thumbnail">
</div>

<h3 id="choice-of-programming-language"><a class="header-link" href="#choice-of-programming-language"></a>Choice of programming language</h3>
<p>In this assignment you must use Java.</p>
<h3 id="important"><a class="header-link" href="#important"></a>Important</h3>
<p>In order to make sure you are using the right version of Java and train
simulator, do not forget to run</p>
<pre class="hljs"><code>setup_course tda381</code></pre><p>on Chalmers GNU/Linux machines.</p>
<hr>
<h3 id="assignment"><a class="header-link" href="#assignment"></a>Assignment</h3>
<p>Your assignment is to write a program that controls the trains. The trains
should run simultaneously between the two stations (<em>note that each station has
two tracks</em>). It is important that the trains are able to move at the same time,
and be as independent from each other as possible, without crashing. At the
stations the trains should stop and then wait 1 to 2 seconds. The trains should
run forever between the stations.</p>
<p>In the beginning there are no sensors on the tracks. You must find where it is
suitable to place sensors so that the control program gets the necessary
information.</p>
<p>The program that you deliver should work as follows. Each train should be
controlled by an independent <em>train program</em>, which runs in its own Java
thread. Train programs cannot communicate with outside world by anything else
than acquiring and releasing semaphores. In particular, no shared variables
should be read or changed by the train programs. Also, both trains must use the
same 'train program', and it is not allowed to make the behaviour of a train
depend on its train id. For example, the track that a train chooses should not
depend on its train id.</p>
<p>Below is a list of more detailed requirements.</p>
<h3 id="requirements"><a class="header-link" href="#requirements"></a>Requirements</h3>
<ul class="list">
<li><p><strong>Command line parameters</strong>. Your program must take three optional parameters
  from the command line that represent the speed for each train, and the speed
  of the simulation. For instance, the line </p>
<pre class="hljs"><code>  $ <span class="hljs-number">2</span> <span class="hljs-string">"tsim --speed 20 Lab1.map"</span> <span class="hljs-string">"java Lab1 10 5 20"</span></code></pre><p>  will launch the simulation at speed <code>20</code>
  with the top train at speed <code>10</code> and the bottom train at speed <code>5</code>.  If the
  first or second parameter is missing, then you may pick any speed in the
  range <code>[1,maxspeed]</code>, and if the third parameter is missing, you must
  default to <code>100</code> as this is the default for the simulator as well.</p>
</li>
<li><p><strong>Accounting for speed at stations</strong>. The trains must wait 1-2 seconds at each
station after coming to a full stop.  Use the following formula (time in ms):
<code>time_at_station + 2 * simulation_speed_parameter * |train_speed|</code></p>
</li>
<li><p><strong>Maximum train speed</strong>. You need to find out the maximum train speed <code>maxspeed</code>
  that is usable with your particular solution. This must be at least <code>15</code>.</p>
</li>
<li><p><strong>No minimal speed</strong>. There should be no assumption about minimal train
  speed. All speeds in the range <code>[1,maxspeed]</code> will be tried.</p>
</li>
<li><p><strong>No excessive semaphores</strong>. Solutions that use <code>10</code> or more semaphores will
  be rejected.</p>
</li>
<li><p><strong>No Polling</strong>. Your solutions must not use <em>busy-waiting-loops</em> or their
close relative, <mark><a href="">polling</a></mark>.</p>
</li>
<li><p><strong>Dynamic behaviour</strong>. You must not statically encode how the trains choose
track at the switches (for example: train 1 always takes the upper path in the
middle, while train 2 always takes the lower; same for stations). You must let
the trains have one track as default (for example: the track with shortest
distance). You must select the other track if the default track is already
occupied by the other train.  Note that you should not try to find a solution
which works for any track layout or any number of trains, as this will be too
complicated for all of us! It is enough to solve the problem for the given track
layout.</p>
</li>
<li><p><strong>No Map Modifications</strong>. You may not alter the map in any way, other than by
  adding sensors.</p>
</li>
<li><p><strong>No randomization</strong>. You may not use randomization in any way that affects the
simulation, as this makes testing more difficult.</p>
</li>
<li><p><strong>Two trains – two threads</strong>. When the system is running there should be only
two processes (threads): one for each train. This is in addition to the main
thread and the thread that handles communication with the simulator. This
latter thread is created in the interface code we provide you with.</p>
</li>
<li><p><strong>Two trains – one implementation</strong>. The solution must use the same
implementation for both trains. The only thing separating the processes of the
different trains is the train id, starting position, and speed. The fact that
the two trains start in different positions means that it is permitted (and
necessary) to have different initial behaviour for the two processes, but
after that the behaviour of the processes <em>must not be dependent</em> on which
train it is acting for.</p>
</li>
<li><p><strong>Use binary semaphores</strong>. You must use the provided binary semaphore for
mutual exclusion. You will have the opportunity to use other synchronisation
mechanisms in the other assignments.</p>
</li>
<li><p><strong>Trains mind their own business</strong>. Trains should operate independently. A
train should not make plans/decisions for the other train. Further, a train
should not make plans/decisions for itself based on the information (speed,
position, direction) of the other one.</p>
</li>
<li><p><strong>Good Train Flow</strong>. The parallel section in the middle of the map must allow
a fast train to overtake a slow train going in the same direction.</p>
</li>
<li><p><strong>Documentation</strong>. In addition to working code you need to provide a convincing
argument why your solution is correct. You must document your solution <strong>with an
ASCII text file</strong>. Give a high-level description of your program and then go
into detail about all pieces of code that are essential for correctness. The
documentation should include everything needed for easy understanding of the
solution. In particular we demand that your documentation contains discussion
on:</p>
<ul class="list">
<li>Placement of the sensors</li>
<li>Choice of critical sections</li>
<li>Maximum train speed and the reason for it</li>
<li>How you tested your solution</li>
</ul>
</li>
<li><p><strong>Code quality</strong>. Reasonable code quality is expected; do not complain if your
  assignment is rejected because we think your program is ugly (magic numbers,
  poor use of types, cut-and-paste coding style) – even if it works.</p>
</li>
<li><p><strong>Submission</strong>. When you submit your solution, you must provide the following
files: </p>
<ul class="list">
<li><code>Lab1.java</code> (your program to control the trains) </li>
<li><code>Lab1.map</code> (which indicates the placement of your sensors) </li>
<li><code>documentation.txt</code> (ASCII file containing your documentation)</li>
</ul>
</li>
</ul>
<hr>
<h2 id="train-simulator"><a class="header-link" href="#train-simulator"></a>Train simulator</h2>
<p>The simulator is called <code>tsim</code> and with this program you can even modify the train
map. You can run <code>tsim</code> as follows:</p>
<ul class="list">
<li><p><code>tsim</code></p>
<ul class="list">
<li>Make a new, empty map, of default size.</li>
</ul>
</li>
<li><p><code>tsim filename</code></p>
<ul class="list">
<li>Read in an old map from file <code>filename</code>. </li>
</ul>
</li>
<li><p><code>tsim --speed 50 filename</code> </p>
<ul class="list">
<li>Read in an old map from file <code>filename</code>, and also
set the simulation speed to <code>50</code>. This value is the number of milliseconds that
<code>tsim</code> waits between updates of its state (i.e moving the trains). <code>100</code> ms is the
default, so <code>50</code> makes the simulation go at double speed.</li>
</ul>
</li>
<li><p><code>tsim --priority 15 --speed 20 filename</code> </p>
<ul class="list">
<li>For extreme simulation speeds you may need to also set the priority of the
simulator process, since otherwise it might move the trains without your
controller program getting time to receive sensor events. The priority value is
the <a href="http://en.wikipedia.org/wiki/Nice_%28Unix">nice value</a>).</li>
</ul>
</li>
<li><p><code>tsim --help</code></p>
<ul class="list">
<li>See all options of the simulator.</li>
</ul>
</li>
</ul>
<h3 id="-tsim-as-a-map-editor"><a class="header-link" href="#-tsim-as-a-map-editor"></a><code>tsim</code> as a map editor</h3>
<p>You need to get your own copy of the map in order to be able to add the
sensors. The map you will be working on is that shown above.</p>
<p>The map file is found in the <a href="http://www.cse.chalmers.se/edu/course/TDA383/lab1.html#downloads">downloads section</a>. Download it to your
working directory (we strongly recommend that you create a subdirectory <code>lab1</code> for
your work with this assignment).</p>
<p>Then you can modify the map by writing <code>tsim Lab1.map</code>. The figure below shows
how to use <code>tsim</code>. You should <em>only</em> select the sensor button in the tools window
(the small T-like symbol) and then use the mouse to place sensors on the track.</p>
<div style="padding: 8px" align="center">
<img src="Lab1_files/tsim.gif" class="img-thumbnail">
</div>

<h3 id="-tsim-as-a-simulator"><a class="header-link" href="#-tsim-as-a-simulator"></a><code>tsim</code> as a simulator</h3>
<p>You may start <code>tsim</code> and interact with it using commands on standard input. Try
for example the commands </p>
<pre class="hljs"><code><span class="hljs-title">SetSpeed</span> <span class="hljs-number">1</span> <span class="hljs-number">20</span>
SetSwitch <span class="hljs-number">17</span> <span class="hljs-number">7</span> RightSwitch</code></pre><p>and see what happens. (The second command is necessary for the train to survive
the first switch which initially is set in the wrong direction). The <code>tsim</code>
language interfaces handle the communication with tsim and let you change the
speed of the trains and the state of the switches in a more convenient way.</p>
<p>Here are some things to note about the simulator:</p>
<ul class="list">
<li><p>When you give a new speed for a train, it takes a while for the train to
increase or decrease from its old to its new speed. This means that the
train's braking distance puts limits on how fast they could drive.</p>
</li>
<li><p>The trains can not turn around, but can be given a negative speed to travel
backwards.</p>
</li>
<li><p>You are not able to give a speed which implies that a train changes
direction. To change direction the train must first be stopped (by giving it
speed 0). There is no signal from the simulator to tell you when the train has
stopped, so you will need to wait a suitable time before changing direction.
This is approximately <code>2 * simulation_speed_parameter * |train_speed|</code>.</p>
</li>
<li><p>You must be careful when you change the switches. If a train comes to a switch
which is in the wrong position, then the train will derail. See the figure
below. </p>
</li>
</ul>
<div style="padding: 8px" align="center">
<img src="Lab1_files/switch.gif" class="img-thumbnail">
</div>


<h3 id="how-your-program-communicates-with-the-simulator"><a class="header-link" href="#how-your-program-communicates-with-the-simulator"></a>How your program communicates with the simulator</h3>
<p>The simulator and your program run as separate OS processes. They use pipes to
communicate. We will have two-way communication, so we will need two pipes. See
the figure below. </p>
<div style="padding: 8px" align="center">
<img src="Lab1_files/communication.gif" class="img-thumbnail">
</div>

<p>You can join together two programs in the above way with the special command
<code>2</code>. This command starts the two commands which are given as arguments, and
joins the output (stdout) of one to the input (stdin) of the other.</p>
<pre class="hljs"><code>$ <span class="hljs-number">2</span> <span class="hljs-string">"tsim Lab1.map"</span> <span class="hljs-string">"java Lab1 10 5"</span></code></pre><p>where <code>Lab1</code> is the class containing your solution.</p>
<h3 id="note-on-debugging"><a class="header-link" href="#note-on-debugging"></a>Note on debugging</h3>
<p>Since both the standard I/O channels are in use, if you want to write something
to the screen (for example, to help with debugging), you must use
<code>System.err.println(String s)</code>.</p>
<hr>
<h2 id="program-simulator-interaction"><a class="header-link" href="#program-simulator-interaction"></a>Program/Simulator interaction</h2>
<p>All commands between the your program and the simulator are sent
line-by-line as text strings, as you saw above. To aid you in your
assignment we provide you with a Java library (<code>TSim</code>) that implements
the protocol <code>tsim</code> is using. You must use this Java library. The
package provides you with an interface to control the behaviour of the
trains and switches. The package is available in the
<a href="http://www.cse.chalmers.se/edu/course/TDA383/lab1.html#downloads">downloads section</a> below.</p>
<p>The Java <code>TSim</code> contains a collection of classes to be used when
communicating with the simulator from Java. You can view the JavaDoc
documentation of the all interface classes
<a href="http://www.cse.chalmers.se/%7Ecajohn/stuff/TSim/doc/">here</a>.</p>
<h3 id="usage"><a class="header-link" href="#usage"></a>Usage</h3>
<p>You cannot create instances of <code>TSimInterface</code> using its constructor, since it
is private. Instead you use the static method <code>getInstance()</code> that creates an
instance of the class if that has not already been done (singleton pattern).</p>
<pre style="" class="prettyprint lang-java prettyprinted"><span class="typ">TSimInterface</span><span class="pln"> tsi </span><span class="pun">=</span><span class="pln"> </span><span class="typ">TSimInterface</span><span class="pun">.</span><span class="pln">getInstance</span><span class="pun">()</span><span class="pln"> </span><span class="pun">;</span></pre>


<h3 id="interesting-classes"><a class="header-link" href="#interesting-classes"></a>Interesting classes</h3>
<ul class="list">
<li><p><code>TSimInterface</code> is the class used to control the trains. It contains methods
to control the speed of the train and to switch the positions of the
switches. All these methods throw a <code>CommandException</code> if some tsim-related
error occurs. In addition there is a method to turn on debugging, which
displays the communication between your program and <code>tsim</code>.  Read the Javadoc
documentation of this class carefully!</p>
</li>
<li><p>SensorEvent represents the event of a train passing over a sensor. Every time
a train passes over a sensor first an <code>ACTIVE</code> event is created followed by an
<code>INACTIVE</code> event when the train leaves the sensor. This class contains the
status of the sensor, the position of the sensor and the identity of the train
causing the event.</p>
</li>
<li><p><code>CommandException</code> represents a failure of one of the methods of
<code>TSimInterface</code>. Information on the error is stored in the exception and can
be acquired by the <code>getMessage</code> method. You should <em>never</em> catch an exception
leaving the exception handler empty! For your own and our best <em>always</em> print
the error message contained in the exception object. Otherwise, your program
will be much harder to debug.</p>
<pre style="" class="prettyprint lang-java prettyprinted"><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="pun">...</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">CommandException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="typ">System</span><span class="pun">.</span><span class="pln">err</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">getMessage</span><span class="pun">());</span><span class="pln">

  </span><span class="com">/* If a command failed then something bad has
     happened and we probably don't want to
     continue executing */</span><span class="pln">

  </span><span class="typ">System</span><span class="pun">.</span><span class="pln">exit</span><span class="pun">(</span><span class="lit">1</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></pre>


</li>
</ul>
<h2 id="downloads"><a class="header-link" href="#downloads"></a>Downloads</h2>
<p>To start you need to download these two files:</p>
<ul class="list">
<li><p>A <a href="http://www.cse.chalmers.se/edu/year/2013/course/TDA382_Concurrent_Programming_HT2013/assignments/1/downloads/Lab1.java">small
example</a>
that starts one of the trains to get you started</p>
</li>
<li><p><a href="http://www.cse.chalmers.se/edu/year/2013/course/TDA382_Concurrent_Programming_HT2013/assignments/1/downloads/Lab1.map">The
 map</a>
to place your sensors on</p>
</li>
</ul>
<p>If you wish to work on this assignment on your own computer, then you can
download the files needed using the links below. Note that we do not have any
experience trying to make the simulator work on windows, it will probably be
quite difficult and we do not provide any help for that, but it is known to work
on Mac and Linux. However, should you succeed, we would be happy to hear about
it. In this case, you will also need these files:</p>
<ul class="list">
<li><p>The Java <a href="http://www.cse.chalmers.se/edu/year/2013/course/TDA382_Concurrent_Programming_HT2013/assignments/1/downloads/Tsim-java.tar.gz"><code>TSim</code>
source</a>,
containing the <code>TSim</code> interface</p>
</li>
<li><p>The simulator <a href="http://www.cse.chalmers.se/edu/year/2013/course/TDA382_Concurrent_Programming_HT2013/assignments/1/downloads/tsim-0.84.tar.gz">source code</a>. To install it, run</p>
<pre class="hljs"><code>$ ./configure
$ make
$ make install</code></pre><p>The default installation path is <code>/usr/local</code>. If you want to install to some
other location instead run <code>./configure --prefix=/your/location</code>. For more
information, see the INSTALL file.</p>
</li>
<li><p>The source of the <a href="http://www.cse.chalmers.se/edu/year/2013/course/TDA382_Concurrent_Programming_HT2013/assignments/1/2.c">2 command</a>. 
Compile it by writing</p>
<pre class="hljs"><code>$ gcc -o <span class="hljs-number">2</span> <span class="hljs-number">2</span>.c</code></pre></li>
</ul>
<p>To unzip and untar the packages use for example (or read the man page of <code>tar</code>
and <code>gzip</code>):</p>
<pre style="" class="prettyprint lang-bash prettyprinted"><span class="pln">$ gzip </span><span class="pun">-</span><span class="pln">dc filename_goes_here</span><span class="pun">.</span><span class="pln">tar</span><span class="pun">.</span><span class="pln">gz </span><span class="pun">|</span><span class="pln"> tar xvf </span><span class="pun">-</span></pre>


<hr>
<h2 id="tips-and-tricks"><a class="header-link" href="#tips-and-tricks"></a>Tips and Tricks</h2>
<ul class="list">
<li><p>Which parts of track are critical resources?</p>
</li>
<li><p>There are two common ways of writing the train programs. One is that the train
remembers in which place on the track it is and performs its actions based on
that (stateful solution). The other is that the train decides what to do based
on the coordinates of the sensor it steps on (stateless solution). In the
stateless solution, you might still have to remember some things, for example
which semaphors you are holding.</p>
</li>
<li><p>Do not try to solve the general problem. Create a solution that works for this
particular exercise. For example, it is OK to assume that there will be only 2
trains on the map. If you are interested in solving the general problem, write
a short description of how to solve it in the documentation file.</p>
</li>
<li><p>If you have to lock two critical sections at the same time, this probably
indicates that your train flow will be poor. Perhaps you need a little bit
more sensors?</p>
</li>
<li><p>It is not necessary for trains to stop exactly at the end of the track at a station (before changing direction).</p>
</li>
<li><p>Do not overoptimise modularity. The assignment is simple enough to have the
solution in one file.</p>
</li>
<li><p>For debugging, it is helpful to print out statements about the state of the
trains and semaphores every time it is changed. </p>
</li>
<li><p>For testing, run multiple instances of the simulator (at a high simulation
speed), with different train speeds for a long time. e.g Test your trains with
the first going very fast and the second going very slow, and vice
versa. Don't set the simulation speed too high (<code>--speed</code> switch should be
about 15 or higher), since the trains might not get commands from your program
on time. Use the <code>--priority</code> switch when running the simulation fast, as
outlined earlier.</p>
</li>
<li><p>Note that <code>get_sensor(TId)</code> <strong>blocks</strong> until the given train (<code>TId</code>) next
passes a sensor.</p>
</li>
<li><p>In previous courses, the best solutions had usually less than 300 lines of
code. If your solution is much bigger than that then you are probably making
it too complicated. Try making it simpler. It is very important that your code
is understandable.</p>
</li>
<li><p>There is no need to have more than a single try-catch in the entire
program (<a href="http://download.oracle.com/javase/tutorial/essential/exceptions/declaring.html">more
information</a>). </p>
</li>
</ul>
<h2 id="note-"><a class="header-link" href="#note-"></a>Note!</h2>
<p>It was stated above but may be stated again: Reasonable code quality is
expected. You are programmers – programming should be an art to you. The quality
of your code will be vital for its reuse and maintenance.</p>
<h2 id="common-reasons-for-rejection"><a class="header-link" href="#common-reasons-for-rejection"></a>Common reasons for rejection</h2>
<h3 id="polling-busy-waiting"><a class="header-link" href="#polling-busy-waiting"></a>Polling/busy waiting</h3>
<p>What is polling and what is not is a hard question. We here give some examples
in pseudo code. Loops that reduce to something similar to the situation below
(where the dots do not include any <em>blocking wait</em>) must be considered as
polling.</p>
<pre style="" class="prettyprint lang-java prettyprinted"><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">#</span><span class="pln"> POLLING</span><span class="pun">!</span><span class="pln">
   </span><span class="pun">...</span><span class="pln">
   sleep</span><span class="pun">(</span><span class="pln">t</span><span class="pun">);</span><span class="pln"> 
   </span><span class="pun">...</span><span class="pln">
</span><span class="pun">}</span></pre>

<p>Using a blocking operation within a loop is not considered as polling.</p>
<pre style="" class="prettyprint lang-java prettyprinted"><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">#</span><span class="pln"> NO POLLING</span><span class="pun">!</span><span class="pln">
   </span><span class="pun">...</span><span class="pln">
   wait</span><span class="pun">(</span><span class="pln">o</span><span class="pun">);</span><span class="pln">
   </span><span class="pun">...</span><span class="pln">
</span><span class="pun">}</span></pre>

<p>if <em>it is not the case</em> that something is regularly waking the process from its
wait. Thus, the following example must be considered as an instance of polling:</p>
<pre style="" class="prettyprint lang-java prettyprinted"><span class="pln">obj o</span><span class="pun">;</span><span class="pln">

process a </span><span class="pun">{</span><span class="pln">   
  </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> 
    sleep</span><span class="pun">(</span><span class="pln">t</span><span class="pun">);</span><span class="pln">
    notify</span><span class="pun">(</span><span class="pln">o</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

process b </span><span class="pun">{</span><span class="pln">  </span><span class="pun">#</span><span class="pln"> POLLING</span><span class="pun">!</span><span class="pln">
  </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    wait</span><span class="pun">(</span><span class="pln">o</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></pre>
    <br>
    <hr>
      <footer>
	Concurrent Programming 2015 - Chalmers University of Technology &amp; Gothenburg University
      </footer>
      <br>
      <br>
  </div>




    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="Lab1_files/jquery-1.js"></script>
    <script src="Lab1_files/bootstrap.js"></script>


<script>
var tags =  ;
for (var i = 0 ; i < tags.length; i++) {
 $('a[href='+ tags[i] + ']').on('click',function(e){
   // prevent normal scrolling action
   e.preventDefault();
   var target = $(this.hash);
   target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
      if (target.length) {
            widow.scrollTo(0, target.offset().top - 60); // <-- our offset
       return false;
   }
 });
}
</script>



</body></html>